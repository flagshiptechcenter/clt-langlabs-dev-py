<!-- overdub.html -->
{% extends "base_activity.html" %}
{% load staticfiles %}

{% block contentwrap %}
{% load guardian_tags %}
{% get_obj_perms user for course as "course_perms" %}
{% get_obj_perms user for activity as "activity_perms" %}

     {% include 'activity_header_template.html' %}

	<div class="container-fluid" style='height:100%;'>
		<div class="row " >
			<div class="col-md-4" > <!-- style="border-right: 1px solid #ccc;" -->
				<h2>Instructions:</h2>
				{% if activity.media or activity.upload_video %}
				    <div id="overdubVideo" class='videoDiv'></div>
				    <script>
						jwplayer("overdubVideo").setup({
						        file: {% if activity.upload_video %}"{{activity.upload_video.url}}"{% else %}"{{activity.media}}"{% endif %},
						        width: "100%",
						        skin: "{% static "jwplayer-skins/five.xml" %}",
                                autostart: true,
						        // controls: false,
						        mute: true
						    });
						// Added auto buffering for overdub Video
					    initialPause = 1
					    jwplayer('overdubVideo').onTime(function(time){
					        if(initialPause==1){
					            jwplayer('overdubVideo').pause()
					            jwplayer('overdubVideo').setVolume(100)
					            initialPause =0
					        }
					    })
					</script> 
				{% endif %}
				{{ activity.instructions|safe }}

			</div>
     		<div id='connectingDIV' class='row col-md-8 show' data-port="{{ chatserver_port}}" data-host="{{ chatserver_host }}" data-protocol="{{ chatserver_protocol }}">
	            <div id='sysMessage' class="col-md-4 col-md-offset-4"><i class="fa fa-spinner fa-spin fa-5x"></i> Connecting to server ...</div>
     		</div>
			<div id="connectedDIV" class="col-md-8 hidden">
	            <div>
					<form role="form">{% csrf_token %}
					<input id='activityType' type="hidden" name="activityTypes" value='{{ activity.activity_type }}'>
					<input id='activityID' type="hidden" name="activityIDs" value='{{ activity.id }}'>
					<input id='activityUSER' type="hidden" name="activityUSERs" value='{{ user }}'>
					<div id='postTextarea' class="form-control" style='border-radius:4px 4px 0px 0px;'></div>
					<div class="input-group">
					<button id='sendPost' type="button" class="btn btn-default btn-xs full-width" value='{% url "save_post" %}' style='border-radius:0px 0px 0px 4px;'><span class="glyphicon glyphicon-send"></span> send</button>
					<div class="input-group-btn">
					<button id='uploadTrigger' type="button" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-file"></span> upload</button>
					<button id='recordTrigger' type="button" class="btn btn-default btn-xs" data-swfurl="{% static "swf/barebonesRecorder7.swf" %}" data-recorderserver='{{recorder_myServer}}' data-recorderhandler='{{recorder_myHandler}}' data-recorderdirectory='{{recorder_myDirectory}}' data-recorderlicense='{{recorder_license}}' data-userinfo='audio_{{ user.id}}_{{user.username}}' data-playerskin="{% static "jwplayer-skins/five.xml" %}" style='border-radius:0px 0px 4px 0px;'><span class="glyphicon glyphicon-record"></span> record</button>
					</div>
					</div>
					</form>
             	</div>
             	<!-- *******************file upload****************** -->
			    <!-- The file input field used as target for the file upload widget -->
			    <input id="fileupload" type="file" name="file" style="display:none;" multiple>
				<!-- The global progress bar -->
				<div id="progress" class="progress" style='height:1px;margin:0px;opacity:0.7;'>
				    <div class="progress-bar progress-bar-success"></div>
				</div>
				<!-- The container for the uploaded files -->
				<div id='inputAttachments'></div>
				<!-- *The container for recorder********* -->
				<div id='CLTREC_container'><div id='CLTREC'></div></div>
				<!-- ************************************************ -->
				<br>


                    <div id='posts' data-ajaxurl='{% url "delete_post" %}' data-saveajaxurl="{% url 'save_post' %}">
                        {% if user_post_num != 0 or not activity.read_after_post or user.is_superuser or user in private_users %}
                            <ul id='posts2' class="chat">
                                {% for post in posts reversed%}
                                    {% if not activity.private_mode or user in private_users or post.creator in private_users or post.creator == user %}
                                        {% if not post.parent_post %}
                                            <!-- Other's posts -->
                                            {% include 'post_template.html' with ativity_type=activity.activity_type %}
                                        {% endif %}
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        {% endif %}
                    </div>


			</div>
		</div>
	</div>
    <div>
		<!-- Small modal -->
		<button class="btn btn-primary hide notificationButton" data-toggle="modal" data-target=".bs-example-modal-sm">Small modal</button>

		<div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
		  <div class="modal-dialog modal-sm">
			    <div class="modal-content">
			      <div class="modal-header" style='padding:9px;'>
			        <h5 class="modal-title" id="myModalLabel">Help Text</h5>
			      </div>
			      <div class="modal-body">
			        Please <kbd>save</kbd> recording before sending post or click <kbd>cancel</kbd>
			      </div>
			    </div>
		  </div>
		</div>
    </div>

{% endblock contentwrap %}

{% block stylesheets %} 
<link href="{% static "css/overdub.css" %}" rel="stylesheet">
<link href="{% static "font-awesome/css/font-awesome.min.css" %}" rel="stylesheet">
<!-- *****************video player(need to be put in head to load audio)******************* -->
<script src="http://jwpsrv.com/library/RJueXGxbEeOB1SIACi0I_Q.js"></script>
{% endblock stylesheets%}
{% block more_javascript %} 
<!-- *****************upload libs******************** -->
<script src="{% static "jqueryUpload/jquery.ui.widget.js" %}"></script>
<script src="{% static "jqueryUpload/jquery.iframe-transport.js" %}"></script>
<script src="{% static "jqueryUpload/jquery.fileupload.js" %}"></script>
<script src="{% static "jqueryUpload/jquery.cookie.js" %}"></script>
<!-- *****************Chat libs******************** -->
<script src="{% static "js/socket.io.js" %}"></script>
<script src="{% static "js/tinymce/tinymce.min.js" %}"></script>
<script>WEB_SOCKET_SWF_LOCATION="{{ STATIC_URL }}flashsocket/WebSocketMain.swf"; window.room = "{{ room.id }}";</script>
<script src="{% static "js/overdub.js" %}"></script>
<script src="{% static "js/overdubs_socket.js" %}"></script>
<!-- ******************Recorder libs****************** -->
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/swfobject/2.2/swfobject.js"></script>
<!-- ************************************* -->
{% endblock more_javascript %}
